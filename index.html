<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Taskify | Advanced Task Manager</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    :root {
      --primary: #4361ee; --secondary: #3a0ca3; --success: #4cc9f0; --danger: #f72585;
      --warning: #fca311; --info: #4895ef; --light: #f8f9fa; --dark: #212529;
      --gray: #6c757d; --bg-color: #f0f2f5; --card-bg: #ffffff;
      --border-radius: 12px; --shadow: 0 6px 15px rgba(0,0,0,0.07); --transition: all .3s ease;
    }
    .dark-mode {
      --bg-color:#1a1c23; --card-bg:#252731; --light:#2d3038; --dark:#f5f5f5;
      --gray:#a0a0a0; --shadow:0 6px 15px rgba(0,0,0,0.25);
    }
    *{margin:0;padding:0;box-sizing:border-box;transition:var(--transition)}
    body{font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;background:var(--bg-color);color:var(--dark);line-height:1.6;padding:20px;min-height:100vh}
    .container{max-width:1000px;margin:0 auto}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:25px;flex-wrap:wrap;gap:15px}
    .app-title{display:flex;align-items:center;gap:12px}
    .app-title h1{font-weight:700;font-size:28px;background:linear-gradient(90deg,var(--primary),var(--secondary));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .app-title i{color:var(--primary);font-size:28px}
    .theme-toggle{background:var(--card-bg);border:none;border-radius:50%;width:45px;height:45px;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:var(--shadow);color:var(--dark)}
    .stats-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:25px}
    .stat-card{background:var(--card-bg);padding:20px;border-radius:var(--border-radius);box-shadow:var(--shadow);text-align:center}
    .stat-card h3{font-size:14px;color:var(--gray);margin-bottom:8px}
    .stat-card p{font-size:28px;font-weight:700;color:var(--primary)}
    .main-card{background:var(--card-bg);border-radius:var(--border-radius);box-shadow:var(--shadow);padding:25px;margin-bottom:25px}
    .input-section{display:grid;grid-template-columns:1fr 120px 120px 140px 50px;gap:12px;margin-bottom:20px}
    input,select,button{padding:14px;border:1px solid var(--light);border-radius:8px;font-size:14px;background:var(--card-bg);color:var(--dark)}
    input:focus,select:focus{outline:none;border-color:var(--primary)}
    #taskInput{padding-left:45px}
    .input-with-icon{position:relative}
    .input-icon{position:absolute;left:15px;top:50%;transform:translateY(-50%);color:var(--gray)}
    .btn-add{background:var(--primary);color:#fff;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:18px}
    .btn-add:hover{background:var(--secondary)}
    .task-list-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;padding-bottom:10px;border-bottom:1px solid var(--light)}
    .sort-options{display:flex;gap:10px}
    .sort-btn{background:var(--light);border:none;padding:8px 12px;border-radius:20px;font-size:13px;cursor:pointer;color:var(--gray)}
    .sort-btn.active{background:var(--primary);color:#fff}
    ul{list-style:none}
    li{display:grid;grid-template-columns:auto 1fr auto;align-items:center;gap:15px;padding:18px;margin:12px 0;border-radius:var(--border-radius);background:var(--card-bg);box-shadow:var(--shadow);border-left:5px solid var(--primary);animation:fadeIn .4s ease}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    li.completed{opacity:.8}
    li.completed .task-text{text-decoration:line-through;color:var(--gray)}
    .task-checkbox{width:22px;height:22px;cursor:pointer;accent-color:var(--primary)}
    .task-content{overflow:hidden}
    .task-text{font-weight:500;margin-bottom:5px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .task-meta{display:flex;gap:12px;font-size:13px;color:var(--gray)}
    .task-priority,.task-category{display:flex;align-items:center;gap:5px}
    .priority-high{border-left-color:var(--danger)}
    .priority-medium{border-left-color:var(--warning)}
    .priority-low{border-left-color:var(--success)}
    .task-actions{display:flex;gap:8px}
    .action-btn{background:var(--light);border:none;width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--dark);font-size:14px}
    .action-btn:hover{background:var(--primary);color:#fff}
    .due-date{display:flex;align-items:center;gap:5px}
    .overdue{color:var(--danger)!important;font-weight:600}
    .empty-state{text-align:center;padding:40px 0;color:var(--gray)}
    .empty-state i{font-size:50px;margin-bottom:15px;opacity:.5}
    .empty-state p{font-size:16px}
    @media (max-width:900px){.input-section{grid-template-columns:1fr}}
    @media (max-width:600px){
      li{grid-template-columns:1fr;text-align:center}
      .task-meta{justify-content:center;flex-wrap:wrap}
      .task-actions{justify-content:center}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="app-title">
        <i class="fas fa-tasks"></i><h1>Taskify</h1>
      </div>
      <button class="theme-toggle" id="themeToggle"><i class="fas fa-moon"></i></button>
    </header>

    <div class="stats-cards">
      <div class="stat-card"><h3>Total Tasks</h3><p id="totalTasks">0</p></div>
      <div class="stat-card"><h3>Completed</h3><p id="completedTasks">0</p></div>
      <div class="stat-card"><h3>Pending</h3><p id="pendingTasks">0</p></div>
      <div class="stat-card"><h3>Overdue</h3><p id="overdueTasks">0</p></div>
    </div>

    <div class="main-card">
      <div class="input-section">
        <div class="input-with-icon">
          <i class="fas fa-pencil-alt input-icon"></i>
          <input type="text" id="taskInput" placeholder="What needs to be done?"/>
        </div>
        <select id="priority">
          <option value="low">Low Priority</option>
          <option value="medium">Medium Priority</option>
          <option value="high">High Priority</option>
        </select>
        <select id="category">
          <option value="Work">Work</option>
          <option value="Personal">Personal</option>
          <option value="Study">Study</option>
          <option value="Health">Health</option>
          <option value="Finance">Finance</option>
        </select>
        <input type="date" id="dueDate"/>
        <button class="btn-add" id="addBtn"><i class="fas fa-plus"></i></button>
      </div>

      <div class="task-list-header">
        <h2>Your Tasks</h2>
        <div class="sort-options">
          <button class="sort-btn active" data-sort="date">Date</button>
          <button class="sort-btn" data-sort="priority">Priority</button>
        </div>
      </div>

      <ul id="taskList"></ul>
    </div>
  </div>

  <script>
    // ===== Simple State =====
    let tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
    let sortBy = 'date';

    // Dark mode on load
    if (localStorage.getItem('darkMode') === 'enabled') {
      document.body.classList.add('dark-mode');
      document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i>';
    }

    // ===== Helpers =====
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => document.querySelectorAll(sel);

    function save() {
      localStorage.setItem('tasks', JSON.stringify(tasks));
      updateStats();
    }

    function daysLeftStr(d) {
      if (!d) return { text: 'No deadline', overdue: false };
      const today = new Date(); today.setHours(0,0,0,0);
      const due = new Date(d);  due.setHours(0,0,0,0);
      const diff = Math.ceil((due - today) / 86400000);
      if (diff === 0) return { text: 'Today', overdue: false };
      if (diff < 0)  return { text: `${Math.abs(diff)} day(s) ago`, overdue: true };
      return { text: `${diff} day(s) left`, overdue: false };
    }

    function updateStats() {
      const total = tasks.length;
      const done = tasks.filter(t => t.completed).length;
      const pending = total - done;
      const today = new Date(); today.setHours(0,0,0,0);
      const overdue = tasks.filter(t => !t.completed && t.dueDate && new Date(t.dueDate).setHours(0,0,0,0) < today).length;
      $('#totalTasks').textContent = total;
      $('#completedTasks').textContent = done;
      $('#pendingTasks').textContent = pending;
      $('#overdueTasks').textContent = overdue;
    }

    // ===== CRUD =====
    function addTask() {
      const text = $('#taskInput').value.trim();
      const priority = $('#priority').value;
      const category = $('#category').value;
      const dueDate = $('#dueDate').value;

      if (!text) return alert('Please enter a task description!');
      tasks.push({ id: Date.now(), text, priority, category, dueDate, completed: false, createdAt: new Date().toISOString() });
      $('#taskInput').value = ''; $('#dueDate').value = '';
      save(); render();
    }

    function toggleTask(id) {
      tasks = tasks.map(t => t.id === id ? { ...t, completed: !t.completed } : t);
      save(); render();
    }

    function editTask(id) {
      const t = tasks.find(x => x.id === id); if (!t) return;
      const txt = prompt('Edit your task:', t.text);
      if (txt !== null && txt.trim() !== '') {
        t.text = txt.trim(); save(); render();
      }
    }

    function deleteTask(id) {
      if (!confirm('Are you sure you want to delete this task?')) return;
      tasks = tasks.filter(t => t.id !== id);
      save(); render();
    }

    // ===== Render =====
    function render() {
      const list = $('#taskList');
      if (!tasks.length) {
        list.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-clipboard-list"></i>
            <p>No tasks found. Add your first task to get started!</p>
          </div>`;
        return;
      }

      const arr = [...tasks];
      if (sortBy === 'date') {
        arr.sort((a,b)=> (a.dueDate?new Date(a.dueDate):Infinity) - (b.dueDate?new Date(b.dueDate):Infinity));
      } else {
        const order = {high:3, medium:2, low:1};
        arr.sort((a,b)=> (order[b.priority]||0) - (order[a.priority]||0));
      }

      let html = '';
      arr.forEach(t => {
        const due = daysLeftStr(t.dueDate);
        html += `
          <li class="priority-${t.priority} ${t.completed ? 'completed' : ''}">
            <input type="checkbox" class="task-checkbox" ${t.completed?'checked':''} data-action="toggle" data-id="${t.id}">
            <div class="task-content">
              <div class="task-text">${t.text}</div>
              <div class="task-meta">
                <span class="task-priority"><i class="fas fa-flag"></i> ${t.priority}</span>
                <span class="task-category"><i class="fas fa-tag"></i> ${t.category}</span>
                <span class="due-date ${due.overdue && !t.completed ? 'overdue':''}">
                  <i class="fas fa-calendar"></i> ${due.text}
                </span>
              </div>
            </div>
            <div class="task-actions">
              <button class="action-btn" data-action="edit" data-id="${t.id}"><i class="fas fa-edit"></i></button>
              <button class="action-btn" data-action="delete" data-id="${t.id}"><i class="fas fa-trash"></i></button>
            </div>
          </li>`;
      });
      list.innerHTML = html;
    }

    // ===== Events (kept super simple) =====
    $('#addBtn').addEventListener('click', addTask);
    $('#taskInput').addEventListener('keypress', e => { if (e.key === 'Enter') addTask(); });

    // Single listener for list actions
    $('#taskList').addEventListener('click', e => {
      const el = e.target.closest('[data-action]');
      if (!el) return;
      const id = Number(el.dataset.id);
      const action = el.dataset.action;
      if (action === 'toggle') toggleTask(id);
      if (action === 'edit')   editTask(id);
      if (action === 'delete') deleteTask(id);
    });

    // Sort buttons
    $$('.sort-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        $$('.sort-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        sortBy = btn.dataset.sort;
        render();
      });
    });

    // Theme toggle
    $('#themeToggle').addEventListener('click', function() {
      document.body.classList.toggle('dark-mode');
      const enabled = document.body.classList.contains('dark-mode');
      localStorage.setItem('darkMode', enabled ? 'enabled' : '');
      this.innerHTML = enabled ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
    });

    // Init
    save(); // ensure stats correct on first load
    render();
  </script>
</body>
</html>